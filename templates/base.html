<!DOCTYPE html>
<html lang="{% block lang %}en{% endblock %}">

<head>
  {% block referrer %}
  {% endblock %}
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5">
  
  <title>{% block title %}Bear Blog{% endblock %}</title>
  {% block canonical %}{% endblock %}
  {% block seo %}{% endblock %}
  {% block imports %}{% endblock %}  
  
  {% block favicon %}
  <link rel="icon" href="/static/logo.png">
  <link rel="apple-touch-icon" href="/static/logo.png">
  {% endblock %}

  <style>
      {% autoescape off %}
      {% block custom_styles %}
        {% include 'styles/blog/default.css' %}
        {% include 'styles/dashboard.css' %}
      {% endblock %}
      {% endautoescape %}
  </style>
</head>

<body class="{% block page_type %}{% endblock %}" onload="(function() { document.cookie = `timezone=${Intl.DateTimeFormat().resolvedOptions().timeZone};path=/`; })()">
  {% if 'lh.co' in request.get_host %}
  <p style="background-color: wheat; position: absolute; top:-15px; right:0; left:0; text-align: center;">
    Development server: {{ request.get_host }}
  </p>
  {% endif %}
  <header>
    <a class="title" href="{% block heading-link %}/{% endblock %}">
      <h1>
        {% block heading %}
        <span class="bear" role="img" aria-label="ASCII bear logo">ʕ•ᴥ•ʔ</span> Bear
        {% endblock %}
      </h1>
    </a>
    <nav>
      {% block nav %}
      {% endblock %}
    </nav>
  </header>
  <main>
    {% block content %}
    {% endblock %}
  </main>
  <footer style="padding:25px 0;">
    {% block footer %}
    {% include 'snippets/dashboard_footer.html' %}
    {% endblock %}
  </footer>

  {% if blog %}
  <script>
        const times = document.querySelectorAll('time');
        const format_string = "{{ blog.date_format }}" || "d M, Y"

        times.forEach(time => {
            time.innerText = formatDate(time.dateTime, format_string)
        });

        function formatDate(dateStr, formatStr) {
            const date = new Date(dateStr);
            const day = date.getDate();
            const month = date.getMonth();
            const year = date.getFullYear();
            const weekday = date.getDay();
            const hours = date.getHours();
            const minutes = date.getMinutes();

            const monthsFull = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
            const monthsShort = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            const daysFull = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
            const daysShort = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];

            function getOrdinal(n) {
            const s = ['th', 'st', 'nd', 'rd'];
            const v = n % 100;
            return s[(v - 20) % 10] || s[v] || s[0];
            }

            const map = {
            'd': () => day.toString().padStart(2, '0'),
            'm': () => (month + 1).toString().padStart(2, '0'),
            'Y': () => year.toString(),
            'y': () => year.toString().slice(-2),
            'F': () => monthsFull[month],
            'j': () => day.toString(),
            'D': () => daysShort[weekday],
            'l': () => daysFull[weekday],
            'S': () => getOrdinal(day),
            'M': () => monthsShort[month],
            'H': () => hours.toString().padStart(2, '0'),
            'h': () => {
                let h = hours % 12;
                h = h === 0 ? 12 : h;
                return h.toString().padStart(2, '0');
            },
            'i': () => minutes.toString().padStart(2, '0'),
            'a': () => hours < 12 ? 'am' : 'pm',
            };

            let result = '';
            for (let char of formatStr) {
                result += map[char] ? map[char]() : char;
            }
            return result;
        }
    </script>
    {% endif %}
</body>
</html>