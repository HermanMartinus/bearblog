<!DOCTYPE html>
<html lang="{% block lang %}en{% endblock %}">

<head>
  {% block referrer %}
  {% endblock %}
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5">
  
  <title>{% block title %}Bear Blog{% endblock %}</title>
  {% block canonical %}{% endblock %}
  {% block seo %}{% endblock %}
  {% block imports %}{% endblock %}  
  
  {% block favicon %}
  <link rel="icon" href="/static/logo.png">
  <link rel="apple-touch-icon" href="/static/logo.png">
  {% endblock %}

  <style>
      {% autoescape off %}
      {% block custom_styles %}
        {% include 'styles/blog/default.css' %}
        {% include 'styles/dashboard.css' %}
      {% endblock %}
      {% endautoescape %}
  </style>
</head>

<body class="{% block page_type %}{% endblock %}" onload="(function() { document.cookie = `timezone=${Intl.DateTimeFormat().resolvedOptions().timeZone};path=/`; })()">
  {% if 'lh.co' in request.get_host %}
  <p style="background-color: wheat; position: absolute; top:-15px; right:0; left:0; text-align: center;">
    Development server: {{ request.get_host }}
  </p>
  {% endif %}
  <header>
    <a class="title" href="{% block heading-link %}/{% endblock %}">
      <h1>
        {% block heading %}
        <span class="bear" role="img" aria-label="ASCII bear logo">ʕ•ᴥ•ʔ</span> Bear
        {% endblock %}
      </h1>
    </a>
    <nav>
      {% block nav %}
      {% endblock %}
    </nav>
  </header>
  <main>
    {% block content %}
    {% endblock %}
  </main>
  <footer style="padding:25px 0;">
    {% block footer %}
    {% include 'snippets/dashboard_footer.html' %}
    {% endblock %}
  </footer>

  {% if blog %}
  <script>
        (() => {
          "use strict";

          // 1. Select all <time> elements
          const times = document.querySelectorAll("time");
          if (!times.length) return;

          // 2. Define the formatting logic
          function formatDate(dateStr, formatStr, locale) {
            const date = new Date(dateStr);
            
            // Helper to use native browser localization
            const getPart = (options) => new Intl.DateTimeFormat(locale, options).format(date);

            const day = date.getDate();
            const month = date.getMonth();
            const hours = date.getHours();
            const minutes = date.getMinutes();

            const map = {
              'd': () => String(day).padStart(2, '0'),
              'j': () => String(day),
              'S': () => {
                const v = day % 100;
                return ['th', 'st', 'nd', 'rd'][(v > 10 && v < 14) ? 0 : (v % 10)] || 'th';
              },
              'm': () => String(month + 1).padStart(2, '0'),
              'M': () => getPart({ month: 'short' }),
              'F': () => getPart({ month: 'long' }),
              'Y': () => getPart({ year: 'numeric' }),
              'y': () => getPart({ year: '2-digit' }),
              'D': () => getPart({ weekday: 'short' }),
              'l': () => getPart({ weekday: 'long' }),
              'H': () => String(hours).padStart(2, '0'),
              'h': () => String(hours % 12 || 12).padStart(2, '0'),
              'g': () => String(hours % 12 || 12),
              'i': () => String(minutes).padStart(2, '0'),
              'a': () => hours < 12 ? 'am' : 'pm',
              'A': () => hours < 12 ? 'AM' : 'PM',
            };

            return [...formatStr].map(c => map[c]?.() ?? c).join('');
          }

          // 3. Detect language
          const lang = document.documentElement.lang || navigator.language;

          // 4. Apply to all elements
          times.forEach(t => {
            const format = "{{ blog.date_format }}" || "d M, Y";
            t.textContent = formatDate(t.getAttribute('datetime') || t.textContent, format, lang);
          });
        })();
    </script>
    {% endif %}
</body>
</html>